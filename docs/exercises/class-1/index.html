<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jonas Skjold Raaschou-Pedersen">
<meta name="dcterms.date" content="2025-09-04">

<title>Exercise Class 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="class-1_files/libs/clipboard/clipboard.min.js"></script>
<script src="class-1_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="class-1_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="class-1_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="class-1_files/libs/quarto-html/popper.min.js"></script>
<script src="class-1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="class-1_files/libs/quarto-html/anchor.min.js"></script>
<link href="class-1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="class-1_files/libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="class-1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="class-1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="class-1_files/libs/bootstrap/bootstrap-08c51c3f28a05300be652669dc15fce5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-the-exercise-class" id="toc-before-the-exercise-class" class="nav-link active" data-scroll-target="#before-the-exercise-class">Before the exercise class</a>
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
  <li><a href="#installing-newest-version-of-python-through-uv" id="toc-installing-newest-version-of-python-through-uv" class="nav-link" data-scroll-target="#installing-newest-version-of-python-through-uv">Installing newest version of Python through uv</a></li>
  </ul></li>
  <li><a href="#exercise-class" id="toc-exercise-class" class="nav-link" data-scroll-target="#exercise-class">Exercise class</a>
  <ul>
  <li><a href="#exercise-1---create-a-project-directory" id="toc-exercise-1---create-a-project-directory" class="nav-link" data-scroll-target="#exercise-1---create-a-project-directory">Exercise 1 - Create a project directory</a></li>
  <li><a href="#exercise-2---create-a-uv-project-and-virtual-environment" id="toc-exercise-2---create-a-uv-project-and-virtual-environment" class="nav-link" data-scroll-target="#exercise-2---create-a-uv-project-and-virtual-environment">Exercise 2 - Create a uv project and virtual environment</a></li>
  <li><a href="#exercise-3---installing-dependencies" id="toc-exercise-3---installing-dependencies" class="nav-link" data-scroll-target="#exercise-3---installing-dependencies">Exercise 3 - Installing dependencies</a></li>
  <li><a href="#exercise-4---interactive-development-whichever-way-you-like" id="toc-exercise-4---interactive-development-whichever-way-you-like" class="nav-link" data-scroll-target="#exercise-4---interactive-development-whichever-way-you-like">Exercise 4 - Interactive development whichever way you like</a></li>
  <li><a href="#exercise-5---logistic-regression---theory" id="toc-exercise-5---logistic-regression---theory" class="nav-link" data-scroll-target="#exercise-5---logistic-regression---theory">Exercise 5 - Logistic Regression - Theory</a></li>
  <li><a href="#exercise-5---logistic-regression---implementation" id="toc-exercise-5---logistic-regression---implementation" class="nav-link" data-scroll-target="#exercise-5---logistic-regression---implementation">Exercise 5 - Logistic Regression - Implementation</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">Further reading</a>
  <ul>
  <li><a href="#git" id="toc-git" class="nav-link" data-scroll-target="#git">Git</a></li>
  <li><a href="#command-line" id="toc-command-line" class="nav-link" data-scroll-target="#command-line">Command line</a>
  <ul class="collapse">
  <li><a href="#tips-for-windows-users" id="toc-tips-for-windows-users" class="nav-link" data-scroll-target="#tips-for-windows-users">Tips for Windows users</a></li>
  </ul></li>
  <li><a href="#other-text-editors" id="toc-other-text-editors" class="nav-link" data-scroll-target="#other-text-editors">Other text editors</a></li>
  <li><a href="#misc." id="toc-misc." class="nav-link" data-scroll-target="#misc.">Misc.</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exercise Class 1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jonas Skjold Raaschou-Pedersen </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 4, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Welcome to the first exercise class of the course. Our course schedule can be found <a href="https://ai-for-humanity-ucph.github.io/2025/schedule/">here</a>. For preparations before the first exercise class please read <a href="#before-the-exercise-class">Before the exercise class</a>.</p>
<section id="before-the-exercise-class" class="level2">
<h2 class="anchored" data-anchor-id="before-the-exercise-class">Before the exercise class</h2>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>In the course our main programming language is <a href="https://www.python.org/">Python</a>. As our package and project manager for Python we will use <a href="https://docs.astral.sh/uv/">uv</a>.</p>
<p>The main goal of the exercise classes is to get hands-on experience with the material covered in the lectures. One of our mantras will be:</p>
<blockquote class="blockquote">
<p>if you canâ€™t code it you donâ€™t understand it</p>
</blockquote>
<p>One of the subgoals of the exercise classes is to develop a fully fledged Python package consisting of implementations of various methods introduced in the course. This will be done incrementally over the course of the exercise classes. The final package will consist of different modules that contains basic implementations of most of the things that have been taught at the lectures.</p>
<p>A Python package consists of different Python <a href="https://docs.python.org/3/tutorial/modules.html">modules</a> (<code>.py</code> files) and to edit those you need a text editor; you can use whichever text editor you like. One option is <a href="https://code.visualstudio.com/">VSCode</a>.</p>
<p>For version control we will use <a href="https://git-scm.com/">git</a> which is the software/technology underlying <a href="https://docs.github.com/en/get-started/start-your-journey/hello-world">GitHub</a> where e.g.&nbsp;the source code for our course <a href="https://github.com/ai-for-humanity-ucph/2025/tree/main">website</a> is hosted. If you arenâ€™t familiar with git then now is the time; I highly recommend reading the first two chapters of the <a href="https://git-scm.com/book/en/v2">this</a>. Also, make sure you understand the difference between Git and Github, see <a href="https://docs.github.com/en/get-started/start-your-journey/about-github-and-git">here</a>.</p>
<p>We will run different commands in our terminal/shell/command line. The shell has a reputation for being complicated and hard to use but ignore this; it is actually quite simple and very powerful. We wonâ€™t do anything fancy but you should be comfortable with opening your shell and running basic commands e.g.&nbsp;executing a Python script like:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mac &amp; Linux</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> scripts/estimate_model.py</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> scripts<span class="dt">\e</span>stimate_model.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>cloning a git repository from GitHub:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone git@github.com:ai-for-humanity-ucph/2025.git</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>creating a directory and changing directory into it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> my-project</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> project</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Further commands will be introduced as we progress through the exercise classes.</p>
</section>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<p>If you havenâ€™t already done so, please install the following software on your computer:</p>
<ol type="1">
<li><a href="https://git-scm.com/downloads">git</a></li>
<li><a href="https://docs.astral.sh/uv/getting-started/installation/">uv</a></li>
</ol>
<p>To check that the installation was successful, run the following commands in your shell:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> <span class="at">--version</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>uv 0.8.14</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> <span class="at">--version</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>git version 2.51.0</code></pre>
</div>
</div>
</section>
<section id="installing-newest-version-of-python-through-uv" class="level3">
<h3 class="anchored" data-anchor-id="installing-newest-version-of-python-through-uv">Installing newest version of Python through uv</h3>
<p>We will use Python version <code>3.13</code> in the exercise classes. To install this with <code>uv</code> run the following command in your shell:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> python install 3.13</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can check what Python versions you have installed by running:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> python list</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>and verify that <code>3.13</code> is listed and installed.</p>
<p>See <a href="https://docs.astral.sh/uv/guides/install-python/#installing-python">the docs</a> for more.</p>
</section>
</section>
<section id="exercise-class" class="level2">
<h2 class="anchored" data-anchor-id="exercise-class">Exercise class</h2>
<p>With <code>uv</code> and <code>git</code> installed, and Python <code>3.13</code> installed through <code>uv</code>, we are ready to start the exercise class.</p>
<section id="exercise-1---create-a-project-directory" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1---create-a-project-directory">Exercise 1 - Create a project directory</h3>
<ol type="1">
<li><p>Create a directory called <code>exercises</code> where you will store all your code for the exercise classes. Try to do this using your shell but you can also point and click if you rather do that. I have for instance created one in my home directory under <code>ai-for-humanity/exercises</code>.</p></li>
<li><p>Open your shell and change directory into your new <code>exercises</code> folder. You can check the current directory by typing <code>pwd</code> (if you are on Mac or Linux; Windows users should use <a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/cd"><code>cd</code></a>).</p>
<p>You should see something like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">pwd</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code> /home/jsr-p/ai-4-humanity/exercises</code></pre>
<p>Proceed to the next exercise with your shell open.</p></li>
</ol>
</section>
<section id="exercise-2---create-a-uv-project-and-virtual-environment" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2---create-a-uv-project-and-virtual-environment">Exercise 2 - Create a uv project and virtual environment</h3>
<ol type="1">
<li><p>Initialize a new Python project with a Python package named <code>ai4h</code> using uv by running the following command in your shell:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> init <span class="at">--name</span> ai4h <span class="at">--package</span> <span class="at">--python</span> 3.13</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>By the way: you can hover over the code and click on the copy to clipboard icon to copy the snippet to your clipboard.</p>
<p>If successful you should have a folder structure similar to:</p>
<pre><code>.
â”œâ”€â”€ .git
â”œâ”€â”€ .gitignore
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ .python-version
â”œâ”€â”€ README.md
â””â”€â”€ src
    â””â”€â”€ ai4h
        â””â”€â”€ __init__.py</code></pre>
<p>Things to note about this is that <code>uv</code>:</p>
<ul>
<li>automatically initialized your <code>exercises</code> folder as a git repository; you can turn this off, see <a href="https://docs.astral.sh/uv/reference/cli/#uv-init--vcs">here</a>, but there is no sane reason to do this; using <code>git</code> in your projects is non-negotiable from now on until forever.</li>
<li>created a <code>.gitignore</code> file for you; this is a file that tells <code>git</code> which files it should ignore. You can append files that you donâ€™t want <code>git</code> to track to this file; we will return this later</li>
<li>created a <code>pyproject.toml</code> file for you; this is a file that contains metadata about your project and its dependencies.</li>
<li>created a <code>.python-version</code> file for you; this is a file that tells <code>uv</code> which Python version to use when you create a virtual environment, which we will do in the next exercise.</li>
<li>created a <code>src</code> folder for you; this is where your package code should go. The package name is <code>ai4h</code> so the code for this package should go inside the <code>src/ai4h</code> folder. Note the <code>__init__.py</code> file; this file tells Python that this directory should be treated as a package; see also <a href="https://docs.python.org/3/tutorial/modules.html#packages">here</a>.</li>
<li>created a <code>README.md</code> file for you; this is a markdown file that contains information about your project e.g.&nbsp;how to use it. You can edit this file using markdown syntax; see <a href="https://www.markdownguide.org/basic-syntax/">here</a> for a quick introduction to markdown.</li>
</ul></li>
<li><p>Edit the <code>pyproject.toml</code> file and change the description field to something that describes your project. You can also change the author field to your name.</p></li>
<li><p>Create a virtual environment for your project by running the following command in your shell:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> venv</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This will create a virtual environment in a folder called <code>.venv</code> in your project directory. Virtual environments are important for reproducibility while they isolate your Python dependencies. See also <a href="https://realpython.com/python-virtual-environments-a-primer/#why-do-you-need-virtual-environments">here</a>.</p></li>
<li><p>Activate your virtual environment. On Mac and Linux you can do this by running:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> .venv/bin/activate</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>On Windows you can do this by running:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">.venv\Scripts\activate</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To check what Python executable your computer will use when executing <code>python</code> try typing (Mac &amp; Linux)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> python</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>and on Windows:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">where</span> python</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>see <a href="https://linux.die.net/man/1/which"><code>which</code></a> and <a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/where"><code>where</code></a>.</p>
<p>You should confirm that the Python executable is located inside your <code>.venv</code> folder.</p>
<p>On my end I get:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> python</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>/home/jsr-p/ai-4-humanity/exercises/.venv/bin/python</code></pre>
<p>i.e.&nbsp;the python executable is inside the <code>.venv/bin/</code> folder of my <code>exercises</code> project folder which is what we want.</p></li>
</ol>
</section>
<section id="exercise-3---installing-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3---installing-dependencies">Exercise 3 - Installing dependencies</h3>
<ol type="1">
<li><p>Add <a href="https://numpy.org/"><code>numpy</code></a> as a dependency to your project by running the following command in your shell:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> add numpy</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This will install <code>numpy</code> in your virtual environment and add it to the <code>pyproject.toml</code> file as a dependency.</p></li>
<li><p>Verify that <code>numpy</code> has been added to the <code>pyproject.toml</code> file by opening it and checking that it is listed under the <code>[project.dependencies]</code> section.</p></li>
<li><p>Open your Python <a href="https://docs.python.org/3/tutorial/interpreter.html">interpreter</a> by typing <code>python</code> in your shell and try typing the following (ignore the <code>&gt;&gt;&gt;</code> if you copy the lines directly):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> ai4h</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> ai4h.main()</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>Hello <span class="im">from</span> ai4h<span class="op">!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Explain to yourself what you just did.</li>
<li>Exit the interpreter by typing <code>quit()</code> or pressing <code>Ctrl+D</code> (Mac &amp; Linux) or <code>Ctrl+Z</code> (Windows).</li>
</ul></li>
<li><p>Remove everything inside the <code>src/ai4h/__init__.py</code> but <em>donâ€™t</em> delete the file entirely.</p></li>
<li><p>If you havenâ€™t already, now is the time to <a href="https://git-scm.com/about/staging-area">stage</a> the relevant files and make a commit.</p>
<p>You should stage the following files:</p>
<pre><code>.gitignore
.python-version
README.md
pyproject.toml
src/ai4h/__init__.py
uv.lock</code></pre>
<p>using <code>git add</code> (or your git GUI of choice) and then make a commit (again either with <code>git commit</code> or your git GUI of choice) with a suitable commit message.</p></li>
<li><p>Create a new folder called <code>src/ai4h/models</code>. Add a <code>__init__.py</code> file underneath it such that Python knows that the subfolder is a package. Finally, create a file inside the folder called <code>linear_model.py</code>. You can do this however you like; one way would be to run the following:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> src/ai4h/models</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> src/ai4h/models/__init__.py src/ai4h/models/linear_model.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This works on Mac &amp; Linux; Windows users can use the <code>Git BASH</code> shell that comes with git and execute the same commands, see <a href="https://gitforwindows.org/">here</a>. See also <a href="https://www.wikiwand.com/en/articles/Touch_(command)">touch</a>.</p>
<p>This module will serve as the home for our code related to linear models.</p></li>
<li><p>Inside <code>src/ai4h/models/linear_model.py</code> insert the following snippet:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test():</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    project_root <span class="op">=</span> Path(<span class="va">__file__</span>).resolve().parents[<span class="dv">3</span>]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    relpath <span class="op">=</span> Path(<span class="va">__file__</span>).resolve().relative_to(project_root)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Hello from `</span><span class="sc">{</span>relpath<span class="sc">}</span><span class="ss">`!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Open your Python interpreter again and try the following:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> ai4h.models <span class="im">import</span> linear_model</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> linear_model.test()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>Hello <span class="im">from</span> `src<span class="op">/</span>ai4h<span class="op">/</span>models<span class="op">/</span>linear_model.py`<span class="op">!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Commit your changes to git.</p></li>
</ol>
</section>
<section id="exercise-4---interactive-development-whichever-way-you-like" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4---interactive-development-whichever-way-you-like">Exercise 4 - Interactive development whichever way you like</h3>
<ol type="1">
<li><p>Instead of using the classic Python interpreter interactively letâ€™s try something different. Run the following command:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> add jupyter <span class="at">--dev</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Notice the speed of <code>uv</code> when installing <code>jupyter</code> and its dependencies (in particular if it is cached on your machine).</p>
<p>There is another way to install <code>jupyter</code> into your environment but this way is the easiest; if you are interested see <a href="https://docs.astral.sh/uv/guides/integration/jupyter/">here</a>.</p></li>
<li><p>Assert whether the first <code>jupyter</code> in your PATH is the one installed into the virtual environment by running <code>which</code>/<code>where</code> as we previously did to assert the same for the Python interpreter.</p></li>
<li><p>Inspect your <code>pyproject.toml</code> file and assert that <code>jupyter</code> has been added as a development dependency under the <code>[dependency-groups.dev]</code> section.</p></li>
<li><p>Create a folder called <code>notebooks</code> in your project directory.</p></li>
<li><p>Start a <code>jupyter lab</code> server by running</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter</span> lab</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or alternatively the more safe: `uv run jupyter lab` (e.g. if you forgot</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># to activate your environment)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>in your shell.</p></li>
<li><p>Open a notebook in the <code>notebooks</code> folder and name it <code>linear_model.ipynb</code>.</p></li>
<li><p>Inside the notebook try to import the <code>linear_model</code> module and run the <code>test</code> function i.e.&nbsp;execute:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ai4h.models <span class="im">import</span> linear_model</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>linear_model.test()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<blockquote class="blockquote">
<p>If you cannot import our <code>ai4h</code> package check whether the kernel you are are using is the one from your virtual environment. One way to debug this is by import the <code>sys</code> module and inspect the <code>sys.executable</code> variable and verifying it uses the Python executable from your virtual environment.</p>
</blockquote></li>
<li><p>By installing <code>jupyter</code> you also install <code>IPython</code>. Try repeating <code>7.</code> using <code>IPython</code> instead of <code>jupyter lab</code>. Start IPython by running:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> run ipython</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Try repeating <code>7.</code> using <code>jupyter console</code> instead of <code>jupyter lab</code>. Start <code>jupyter console</code> by running:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> run jupyter console</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>I prefer <code>IPython</code> but you can of course use whatever you like.</p></li>
<li><p>Add the line <code>.ipynb_checkpoints/</code> to your <code>.gitignore</code> file. Add the the changes to <code>uv.lock</code>, <code>pyproject.toml</code>, <code>.gitignore</code> and your notebook <code>notebooks/linear_model.ipynb</code>. Commit the changes.</p></li>
</ol>
</section>
<section id="exercise-5---logistic-regression---theory" class="level3">
<h3 class="anchored" data-anchor-id="exercise-5---logistic-regression---theory">Exercise 5 - Logistic Regression - Theory</h3>
<p>Alright, enough with coding for a moment. One of the most important fundamental models in machine learning and data science is the logistic regression model. In the following exercise we will derive some expressions that will help us to estimate the parameters in a logistic regression model. Grab a pen and paper and give the following exercises a try.</p>
<p>Let <span class="math inline">\(Y_i \in \{0, 1\}\)</span> be a binary random variable and <span class="math inline">\(X_i \in \mathbb{R}^{p +
1}\)</span> a vector of covariates, where we assume the first entry is a <span class="math inline">\(1\)</span> for the constant term. The logistic regression model models the probability:</p>
<p><span id="eq-logreg"><span class="math display">\[
P(Y_i = 1 \mid X_{i}) =
\frac{\exp \{X_i^\top \beta\}}
{1 + \exp \{X_i^\top \beta\}}
=: \sigma(X_i^\top \beta)
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(\sigma: \mathbb{R} \to [0, 1]\)</span> is the sigmoid function (also known as the <em>expit</em> function). We assume we have an i.i.d sample of <span class="math inline">\(n\)</span> observations i.e.&nbsp;<span class="math inline">\(\{(Y_{i},
X_{i})\}_{i=1}^{n}\)</span>.</p>
<p>We will estimate <span class="math inline">\(\beta\)</span> using the iteratively reweighted least squares (IRLS) algorithm and implement it inside of <code>src/ai4h/models/linear_model.py</code> package.</p>
<hr>
<ol type="1">
<li><p>Show that we can go from the probability in <a href="#eq-logreg" class="quarto-xref">Equation&nbsp;1</a> to the log odds form: <span id="eq-logodds"><span class="math display">\[
\mathrm{logit} (P(Y_i = 1 \mid X_{i}))
:=
\log \frac{P(Y_i = 1 \mid X_{i})}{1 - P(Y_i = 1 \mid X_{i})}
= X_i^\top \beta.
\tag{2}\]</span></span></p>
<p><a href="#eq-logodds" class="quarto-xref">Equation&nbsp;2</a> shows that the log odds is linear in the parameters <span class="math inline">\(\beta\)</span> and that the <em>logit</em> function is the inverse of the sigmoid function.</p></li>
<li><p>Write sigmoid function as a function of the variable <span class="math inline">\(z \in \mathbb{R}\)</span>:</p>
<p><span class="math display">\[
\sigma(z) = \frac{1}{1 + \exp(-z)}.
\]</span></p>
<p>Show that</p>
<p><span id="eq-sigmoid1"><span class="math display">\[
1 - \sigma(z) = \sigma(-z).
\tag{3}\]</span></span></p></li>
<li><p>Show that</p>
<p><span id="eq-sigmoid2"><span class="math display">\[
\frac{\partial}{\partial \beta} \sigma(X_i^\top \beta)
= X_{i} \sigma(X_{i}'\beta) [1 - \sigma(X_{i}'\beta)].
\tag{4}\]</span></span></p>
<p>Note that <span class="math inline">\(\frac{\partial}{\partial \beta} \sigma(X_i^\top \beta) \in
\mathbb{R}^{p + 1}\)</span> is a vector.</p>
<p>Use <a href="#eq-sigmoid1" class="quarto-xref">Equation&nbsp;3</a> to help you in the last step.</p></li>
<li><p>Show that the log-likelihood function can be written as:</p>
<p><span id="eq-loglik"><span class="math display">\[
\ell(\beta) := \sum_{i=1}^{n}
  \left[ Y_{i} \sigma(X_{i}^{\top}\beta)
     + (1 - Y_{i}) \{1 - \sigma(X_{i}^{\top}\beta)\} \right]
\tag{5}\]</span></span> In the following we write <span class="math inline">\(\ell_{i}(\beta)\)</span> for an element of the sum in <a href="#eq-loglik" class="quarto-xref">Equation&nbsp;5</a>.</p></li>
<li><p>Show that:</p>
<p><span id="eq-loglik-deriv-term"><span class="math display">\[
\frac{\partial}{\partial \beta} \ell_{i}(\beta)
= X_{i}[Y_{i} - \sigma(X_{i}^{\top}\beta)]
\tag{6}\]</span></span></p>
<p>and hence: <span id="eq-loglik-deriv"><span class="math display">\[
\frac{\partial}{\partial \beta} \ell(\beta)
= \sum_{i=1}^{n} X_{i}[Y_{i} - \sigma(X_{i}^{\top}\beta)]
\tag{7}\]</span></span> using linearity of the derivative.</p></li>
<li><p>Show that:</p>
<p><span class="math display">\[
\frac{\partial^{2}}{\partial \beta \partial \beta^{\top}}
\ell_{i}(\beta)
= -X_{i} \sigma(X_{i}'\beta) [1 -
\sigma(X_{i}'\beta)]X_{i}^{\top}
\]</span></p>
<p>and hence</p>
<p><span id="eq-loglik-hessian"><span class="math display">\[
\frac{\partial^{2}}{\partial \beta \partial \beta^{\top}} \ell(\beta)
= - \sum_{i}^{n} X_{i} \sigma(X_{i}'\beta) [1 -
\sigma(X_{i}'\beta)]X_{i}^{\top}.
\tag{8}\]</span></span></p>
<blockquote class="blockquote">
<p>Hint: take the derivative of <a href="#eq-loglik-deriv-term" class="quarto-xref">Equation&nbsp;6</a> wrt. the transpose <span class="math inline">\(\beta^{\top}\)</span> yielding the requested <span class="math inline">\((p + 1) \times (p + 1)\)</span> Hessian matrix.</p>
</blockquote></li>
<li><p>Show that <a href="#eq-loglik-hessian" class="quarto-xref">Equation&nbsp;8</a> can be written in matrix form as:</p>
<p><span id="eq-mat-hessian"><span class="math display">\[
\frac{\partial^{2}}{\partial \beta \partial \beta^{\top}} \ell(\beta)
= - \mathbf{X}^{\top} \mathbf{W} \mathbf{X}
\tag{9}\]</span></span></p>
<p>where</p>
<p><span class="math display">\[
\begin{aligned}
\mathbf{W}
&amp;:= \text{diag}\left(
\sigma(X_1^\top \beta) [1 - \sigma(X_1^\top \beta)],
\ldots,
\sigma(X_n^\top \beta) [1 - \sigma(X_n^\top \beta)]
\right)                  \\
   &amp; =
\begin{bmatrix}
   \sigma(X_1^\top \beta) [1 - \sigma(X_1^\top \beta)] &amp; \ldots
                                                       &amp; 0                                                            \\
   \vdots                                              &amp; \ddots &amp; \vdots                                              \\
   0                                                   &amp; \ldots &amp; \sigma(X_n^\top \beta) [1 - \sigma(X_n^\top \beta)] \\
\end{bmatrix}
\in \mathbb{R}^{n \times n}
\end{aligned}
\]</span></p>
<p>and <span class="math inline">\(\mathbf{X}\)</span> is the <span class="math inline">\(n \times p\)</span> matrix with the <span class="math inline">\(X_{i}^{\top}\)</span>â€™s stacked along the rows. Here we used the <a href="https://www.wikiwand.com/en/articles/Diagonal_matrix#Vector-to-matrix_diag_operator">diag operator</a>.</p>
<p>Define <span class="math inline">\(\mathbf{y} \in \mathbb{R}^{n \times 1}\)</span> as the column vector with the <span class="math inline">\(Y_i\)</span>â€™s stacked along the rows and <span class="math inline">\(\mathbf{p} := \sigma(\mathbf{X} \beta) \in \mathbb{R}^{n \times 1}\)</span> as the column vector of probabilities for each <span class="math inline">\(i\)</span> (where we apply the sigmoid function elementwise).</p>
<p>Show also that <a href="#eq-loglik-deriv" class="quarto-xref">Equation&nbsp;7</a> can be written in matrix form as:</p>
<p><span id="eq-mat-score"><span class="math display">\[
\frac{\partial}{\partial \beta} \ell(\beta)
= \mathbf{X}^{\top} (\mathbf{y} - \mathbf{p})
\tag{10}\]</span></span></p></li>
<li><p>The score equations are given by</p>
<p><span class="math display">\[
\frac{\partial}{\partial \beta} \ell(\beta) = 0
\]</span></p>
<p>which are <span class="math inline">\(p + 1\)</span> equations nonlinear in <span class="math inline">\(\beta\)</span>.</p>
<p>We can solve the score equations using the Newton-Rhapson algorithm as written on page 120 in <a href="https://hastie.su.domains/ElemStatLearn/">ESLII</a>.</p>
<p>Let <span class="math inline">\(\beta_{t}\)</span> be the value of <span class="math inline">\(\beta\)</span> at iteration <span class="math inline">\(t\)</span>. A single Newton update is:</p>
<p><span id="eq-update"><span class="math display">\[
\beta_{t} = \beta_{t - 1}
- \left(
\frac{\partial^{2}}{\partial \beta \partial \beta^{\top}} \ell(\beta)
\right)^{-1}
\frac{\partial}{\partial \beta} \ell(\beta)
\tag{11}\]</span></span></p>
<p>Use <a href="#eq-mat-hessian" class="quarto-xref">Equation&nbsp;9</a> and <a href="#eq-mat-score" class="quarto-xref">Equation&nbsp;10</a> to show that <a href="#eq-update" class="quarto-xref">Equation&nbsp;11</a> can be written as:</p>
<p><span id="eq-irls"><span class="math display">\[
\beta_{t} = (\mathbf{X}^{\top} \mathbf{W}
\mathbf{X})^{-1}\mathbf{X}^{\top}\mathbf{W} \mathbf{Z}
\tag{12}\]</span></span></p>
<p>where</p>
<p><span id="eq-adjusted-response"><span class="math display">\[
\mathbf{Z} := \mathbf{X} \beta_{t - 1} + \mathbf{W}^{-1}(\mathbf{y} -
\mathbf{p})
\tag{13}\]</span></span> is the <em>adjusted response</em>.</p>
<p>It is called the iteratively reweighted least squares algorithm while it at each iteration <span class="math inline">\(t\)</span> solves a weighted least squares problem, which can be seen by comparing the expression <a href="#eq-irls" class="quarto-xref">Equation&nbsp;12</a> with e.g.&nbsp;the solution <a href="https://www.wikiwand.com/en/articles/Weighted_least_squares#Parameter_errors_and_correlation">here</a>. The <em>re</em>weighting happens while the weights are updated at each iteration because they depend on the current value of <span class="math inline">\(\beta\)</span>.</p></li>
</ol>
</section>
<section id="exercise-5---logistic-regression---implementation" class="level3">
<h3 class="anchored" data-anchor-id="exercise-5---logistic-regression---implementation">Exercise 5 - Logistic Regression - Implementation</h3>
<p>All the following code should go into the <code>src/ai4h/models/linear_model.py</code> module. However, when working iteratively on your implementations, you work however and whereever you like. Only the final result should go into your package.</p>
<ol type="1">
<li><p>Implement the <em>expit</em> function <span class="math inline">\(\sigma\)</span> in <a href="#eq-logreg" class="quarto-xref">Equation&nbsp;1</a> using <code>numpy</code>.</p></li>
<li><p>Simulate from the logistic regression model using <a href="#eq-logreg" class="quarto-xref">Equation&nbsp;1</a>. Name your function <code>generate_logreg_data</code>. It should return two arrays <code>X, y</code> with the simulated covariates and binary outcomes respectively. It should have the following signature:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_logreg_data(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a> n: <span class="bu">int</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a> beta: NDArray[np.float64],</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a> seed: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[NDArray[np.float64], NDArray[np.int64]]:</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    ...</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<blockquote class="blockquote">
<p>Note: You donâ€™t have to type hint your function as I do. See <a href="https://numpy.org/doc/stable/reference/typing.html">here</a> for more on type hinting numpy arrays and <a href="https://docs.python.org/3/library/typing.html">here</a> for type hinting in general if you are interested. Type hinting can help e.g.&nbsp;yourself (and LLMâ€™s) to reason about your code.</p>
</blockquote>
<p>Your function should:</p>
<ol type="1">
<li><p>Compute the value of <code>p</code> (number of covariates) from the length of the <code>beta</code> vector.</p></li>
<li><p>Use <code>np.random.default_rng</code> to create a random number generator called <code>rng</code> to subsequently draw random numbers from. See <a href="https://numpy.org/doc/2.3/reference/random/generator.html#numpy.random.default_rng">here</a> and <a href="https://numpy.org/doc/stable/reference/random/index.html">here</a>.</p></li>
<li><p>Simulate a matrix <code>X</code> of shape <code>(N, p + 1)</code> where the first column is all ones (for the constant term) and the remaining <code>p</code> columns are drawn i.i.d from <span class="math inline">\(\mathrm{Unif}(-1, 1)\)</span> (random uniform on <span class="math inline">\([-1, 1]\)</span>).</p></li>
<li><p>Draw <span class="math inline">\(\mathbf{y}\)</span> by using <a href="https://numpy.org/doc/2.3/reference/random/generated/numpy.random.Generator.binomial.html"><code>rng.binomial</code></a> with <code>n=1</code> and probability parameter <code>p</code> equal to <span class="math inline">\(\mathbf{p}\)</span>.</p>
<blockquote class="blockquote">
<p>Note: The probability parameter <code>p</code> is not to be confused with the number of covariates also denoted by <code>p</code> ðŸ« </p>
</blockquote></li>
</ol></li>
<li><p>Generate a dataset with <code>n = 10_000</code> observations using a parameter vector equal to <span class="math inline">\(\beta = (1, 1, -1)^{\top}\)</span> i.e.&nbsp;<span class="math inline">\(p + 1 = 3\)</span> (the first parameter is for the constant term).</p></li>
<li><p>Implement the IRLS algorithm based on <a href="#eq-irls" class="quarto-xref">Equation&nbsp;12</a> and <a href="#eq-adjusted-response" class="quarto-xref">Equation&nbsp;13</a>. Do this by writing a function called <code>irls</code> with the following signature:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> irls(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    X: NDArray[np.float64],</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    y: NDArray[np.int64],</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    tol: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1e-8</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    max_iter: <span class="bu">int</span> <span class="op">=</span> <span class="dv">100</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Iteratively reweighted least squares solver."""</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    ...</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>At each iteration you should check whether the algorithm has converged by using the following condition:</p>
<p><code>np.any(np.abs(beta_t_next - beta_t) &gt; tol)</code></p>
<p>Your function should return a dictionary with the following keys and values:</p>
<ul>
<li><code>"estimates"</code>: The estimated parameters as a 1d numpy array of shape <code>(p + 1,)</code>.</li>
<li><code>"iterations"</code>: The number of iterations the algorithm ran.</li>
<li><code>"converged"</code>: A boolean indicating whether the algorithm converged (i.e.&nbsp;whether the algorithm stopped because it reached the tolerance level before reaching the maximum number of iterations).</li>
</ul>
<p>Note: It is important that you initialize <code>beta</code> to be a<code>(X.shape[0], 1)</code> column vector such that <code>X @ beta</code> also equals a column vector. Likewise, if not already you should make <code>y</code> equal a <code>(n, 1)</code> column vector. This is for the matrix operations of <a href="#eq-adjusted-response" class="quarto-xref">Equation&nbsp;13</a> to make sense.</p></li>
<li><p>Finish the <code>LogisticRegression</code> class below. Remove the lines <code>raise NotImplementedError()</code> and insert the relevant code instead. Get guidance from the docstrings.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LogisticRegression:</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.coef_ <span class="op">=</span> <span class="va">None</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n_iter_ <span class="op">=</span> <span class="va">None</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.converged_ <span class="op">=</span> <span class="va">None</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X: NDArray[np.float64], y: NDArray[np.int64]):</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Estimate the Logistic Regression model using IRLS"""</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span>()</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.coef_ <span class="op">=</span> result[<span class="st">"estimates"</span>]</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n_iter_ <span class="op">=</span> result[<span class="st">"iterations"</span>]</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.converged_ <span class="op">=</span> result[<span class="st">"converged"</span>]</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict_proba(<span class="va">self</span>, X: NDArray[np.float64]) <span class="op">-&gt;</span> NDArray[np.float64]:</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Compute predicted probabilities."""</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.coef_ <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Model is not fitted yet."</span>)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span>()</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict(<span class="va">self</span>, X: NDArray[np.float64]) <span class="op">-&gt;</span> NDArray[np.int64]:</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Predict binary outcomes based on a 0.5 threshold."""</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.coef_ <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Model is not fitted yet."</span>)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">NotImplementedError</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div></li>
<li><p>Test your implementation by running the following code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10_000</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>logreg <span class="op">=</span> LogisticRegression()</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="fl">1.0</span>, <span class="op">-</span><span class="fl">1.0</span>])</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> generate_logreg_data(n, beta, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>logreg.fit(X, y)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Converged:"</span>, logreg.converged_)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Iterations:"</span>, logreg.n_iter_)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Estimates:"</span>, logreg.coef_)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You might have to import the relevant functions from your package depending on how you choose to run the code.</p>
<p>You should get something like the following output:</p>
<pre><code> Converged: True
 Iterations: 6
 Estimates: [ 0.99101948  0.94728109 -0.93985356]</code></pre></li>
<li><p><strong>Bonus</strong>: implement the negative of the log-likelihood in <a href="#eq-loglik" class="quarto-xref">Equation&nbsp;5</a> named <code>neg_loglik</code> with the following signature:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> neg_loglik(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    X: NDArray[np.float64], y: NDArray[np.float64], beta: NDArray[np.float64]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""negative log likehood for logistic regression"""</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">NotImplementedError</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then install <code>scipy</code> in by running:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uv</span> pip install scipy</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>and run the following snippet:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ai4h.models.linear_model <span class="im">import</span> generate_logreg_data, neg_loglik</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10_000</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="fl">1.0</span>, <span class="op">-</span><span class="fl">1.0</span>])</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> generate_logreg_data(n, beta, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> minimize(</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> b: neg_loglik(X, y, b),</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    x0<span class="op">=</span>np.zeros(X.shape[<span class="dv">1</span>]),</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">"BFGS"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> res.success:</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Estimates:"</span>, res.x)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Optimization failed:"</span>, res.message)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Compare your estimates with the ones from the previous exercise.</p>
<blockquote class="blockquote">
<p>Note: we did not add scipy to our <code>pyproject.toml</code> file as a dependency. This is because we only need it for this bonus exercise. <code>uv pip install</code> only temporarily installs the package in your environment but does not add it to your <code>pyproject.toml</code> file.</p>
</blockquote></li>
</ol>
</section>
</section>
<section id="further-reading" class="level2">
<h2 class="anchored" data-anchor-id="further-reading">Further reading</h2>
<p>Below are some miscellaneous links that you might find useful. None of them are required to succeed in the course; neither are they required reading; however, reading some of them might change your life (for the better).</p>
<section id="git" class="level3">
<h3 class="anchored" data-anchor-id="git">Git</h3>
<ul>
<li><a href="https://git-scm.com/book/en/v2">Git Book</a></li>
<li><a href="https://code.visualstudio.com/docs/sourcecontrol/overview">VsCode extension</a> for Git</li>
<li><a href="https://github.com/jesseduffield/lazygit">Lazygit</a> (what I use besides the command line interface of <code>git</code>)</li>
</ul>
</section>
<section id="command-line" class="level3">
<h3 class="anchored" data-anchor-id="command-line">Command line</h3>
<p>If you want to learn more about the command line see e.g.:</p>
<ul>
<li><a href="https://aeturrell.github.io/coding-for-economists/wrkflow-command-line.html">Coding for Economist</a></li>
<li><a href="https://raw.githack.com/uo-ec607/lectures/master/03-shell/03-shell.html#1">Data Science for Economist</a></li>
<li><a href="https://jeroenjanssens.com/dsatcl/chapter-1-introduction#what-is-the-command-line">Data Science at the Command Line</a></li>
<li><a href="https://missing.csail.mit.edu/2020/course-shell/">MIT Missing Semester</a></li>
</ul>
<p>If you really want to become a controller of AI and conjurer of models you should get comfortable with the command line.</p>
<section id="tips-for-windows-users" class="level4">
<h4 class="anchored" data-anchor-id="tips-for-windows-users">Tips for Windows users</h4>
<p>If you are a Windows users see Grant McDermottâ€™s (Principal Economist at Amazon) slides <a href="https://raw.githack.com/uo-ec607/lectures/master/03-shell/03-shell.html#146">here</a> for two ways to get the Unix shell (which is what Mac and Linux users have by default) on Windows. Try following <a href="https://grantmcdermott.com/">Grant McDermottâ€™s</a> advice in his slides and install <a href="https://learn.microsoft.com/en-us/windows/wsl/install">WSL</a>.</p>
<p>If you feel even more adventurous you can try installing a Linux distribution. This is the proper way to get the full Unix experience. For instance, you can try dual-booting <a href="https://help.ubuntu.com/community/WindowsDualBoot">Ubuntu</a> or go directly to <a href="https://archlinux.org/">this</a> (donâ€™t hesitate to ask me for details if you are interested); you wonâ€™t regret it.</p>
</section>
</section>
<section id="other-text-editors" class="level3">
<h3 class="anchored" data-anchor-id="other-text-editors">Other text editors</h3>
<p>If you have already used VsCode and arenâ€™t that impressed you could try out a text editor called <a href="https://neovim.io/">NeoVim</a>. I have some introductory slides that introduces it <a href="https://jsr-p.github.io/PechaKucha/#/title-slide">here</a>.</p>
</section>
<section id="misc." class="level3">
<h3 class="anchored" data-anchor-id="misc.">Misc.</h3>
<p>More useful things to know about:</p>
<ul>
<li><a href="https://www.wikiwand.com/en/articles/PATH_(variable)">PATH variable</a></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>